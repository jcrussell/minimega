# launch router to be the relay
vm config net A B C
vm config preinit $minirouterfs/preinit
vm config filesystem $minirouterfs
vm launch container relay

# launch router to serve dhcp
clear vm config
vm config net A
vm config filesystem $minirouterfs
vm launch container dhcp-server

# launch client to try to dhcp via relay
clear vm config
vm config net B
vm config filesystem $containerfs
vm launch container client

# launch client to try to dhcp from server on relay
clear vm config
vm config net C
vm config filesystem $containerfs
vm launch container client2

router dhcp-server interface 0 10.0.0.2/24
router dhcp-server dhcp 10.0.0.2 range 10.0.1.2 10.0.1.2 255.255.255.0
router dhcp-server gw 10.0.0.1
router dhcp-server commit

router relay interface 0 10.0.0.1/24
router relay interface 1 10.0.1.1/24
router relay interface 2 10.0.2.1/24
router relay dhcp 10.0.1.1 relay 10.0.0.2
router relay dhcp 10.0.2.1 range 10.0.2.2 10.0.2.2
router relay route ospf 0 0
router relay route ospf 0 1
router relay route ospf 0 2
router relay commit

vm start relay,dhcp-server
shell sleep 30

# for debugging... can remove later
capture pcap vm relay 0 relay-A.pcap
capture pcap vm relay 1 relay-B.pcap
capture pcap vm dhcp-server 0 dhcp-server.pcap

# start client, give it time to dhcp
vm start client,client2
shell sleep 30

.columns name,ip vm info
